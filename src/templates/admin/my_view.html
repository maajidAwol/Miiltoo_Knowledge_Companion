<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Include Bootstrap CSS (you may need to adjust the paths) -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <title>Contest generation</title>
    <style>
        .centered {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h6><a href="/">home</a></h6>
    </div>
    <div class="container mt-4">
        <div class="centered">
            <div class="card">
                <div class="card-body">
                    <div id="history-quiz-form">
                        <button class="btn btn-primary" id="fetch-quiz">Generate Contest</button>
                        <div id="history-quiz-container"></div>
                        <div id="history-results" style="display: none"></div>

                        <div class="form-group">
                            <label for="myTextarea">Contest Data</label>
                            <textarea class="form-control" id="myTextarea" cols="100" rows="10"></textarea>
                        </div>
                       <a href="/save_contest_data">
    <button type="button" class="btn btn-success" id="Save">
        Save Contest Data <i class="fas fa-arrow-alt-circle-up"></i>
    </button>
</a>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Include Bootstrap JS (you may need to adjust the paths) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>


<script>
    const fetchQuizButton = document.getElementById("fetch-quiz");
const quizContainer = document.getElementById("history-quiz-container");

var textarea = document.getElementById('myTextarea');
fetchQuizButton.addEventListener("click", function (event) {
  event.preventDefault();

  fetchQuizButton.style.display = "none";
  quizContainer.innerHTML = ""; // Clear the previous quiz content
 
  
  fetch("/contest_generate", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify({
      chapter: "chapter 1",
      subtopic: "1.1",
      number: 1,
      book_choice: "/bk/ETH/biology_g-9.pdf",
    }),
  })
    .then((response) => {
      if (!response.ok) {
        throw new Error("Network response was not ok");
      }
      return response.json();
    })
    .then((data) => {

      if (data) {
        quizData = data;
const jsonString = JSON.stringify(quizData, null, 2); // Convert to a formatted string with 2 spaces of indentation

quizContainer.innerHTML = `<pre>${jsonString}</pre>`;

            
textarea.value = jsonString;
        fetchQuizButton.style.display = "block";
      } else {
        // Handle the case where the response is empty or doesn't contain quiz data
        // You can show an error message or take appropriate action here
        fetchQuizButton.style.display = "block";
        quizContainer.innerHTML =
          '<span style="color:red;">error generating quiz please re generate </span>';
        console.error("Empty or invalid response from the server");
        alert("Error: Empty or invalid response from the server");
      }
    })
    .catch((error) => {
      // Handle network errors or other exceptions here
      quizContainer.innerHTML =
        '<span style="color:red;">error generating quiz please re generate </span>';

      fetchQuizButton.style.display = "block";
      console.error("Error fetching data:", error);
      alert("Error fetchinmmg data: " + error.message);
    });

  return false; // Prevent form submission
});
// Get the "Save" button element
const saveButton = document.getElementById("Save");

// Add a click event listener to the button
saveButton.addEventListener("click", function() {
    // Define the function inside the event listener
    function sendPostRequest() {
        const contestData = document.getElementById("myTextarea").value; // Get the textarea data

        // Send a POST request to the /save_contest_data route
       fetch('/save_contest_data', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
    },
    body: JSON.stringify({ contestData: contestData }), // Send the textarea data as JSON
})
        .then(response => {
            if (response.ok) {
                // Request was successful
                return response.json(); // If the response is JSON
            } else {
                // Handle errors or other responses
                throw new Error('Network response was not ok');
            }
        })
        .then(data => {
            // Process the response data if needed
            console.log(data); // Replace with your handling logic
            // Navigate back to the previous page
            window.history.back();
        })
        .catch(error => {
            // Handle network errors or other exceptions here
            console.error('Error:', error);
            // Navigate back to the previous page even on error
            window.history.back();
        });
    }

    // Call the function
    sendPostRequest();
    window.history.back();
});


</script>